{"ast":null,"code":"import fetch from 'node-fetch';\nimport { ApolloClient, ApolloLink, InMemoryCache, createHttpLink } from \"@apollo/client\";\n/**\n * Middleware operation\n * If we have a session token in localStorage, add it to the GraphQL request as a Session header.\n */\n\nexport const middleware = new ApolloLink((operation, forward) => {\n  /**\n   * If session data exist in local storage, set value as session header.\n   */\n  const session = false ? localStorage.getItem(\"woo-session\") : null;\n\n  if (session) {\n    operation.setContext(({\n      headers = {}\n    }) => ({\n      headers: {\n        \"woocommerce-session\": `Session ${session}`\n      }\n    }));\n  }\n\n  return forward(operation);\n});\n/**\n * Afterware operation.\n *\n * This catches the incoming session token and stores it in localStorage, for future GraphQL requests.\n */\n\nexport const afterware = new ApolloLink((operation, forward) => {\n  return forward(operation).map(response => {\n    /**\n     * Check for session header and update session in local storage accordingly.\n     */\n    const context = operation.getContext();\n    const {\n      response: {\n        headers\n      }\n    } = context;\n    const session = headers.get(\"woocommerce-session\");\n\n    if (session) {\n      // Remove session data if session destroyed.\n      if (\"false\" === session) {\n        localStorage.removeItem(\"woo-session\"); // Update session new data if changed.\n      } else if (localStorage.getItem(\"woo-session\") !== session) {\n        localStorage.setItem(\"woo-session\", headers.get(\"woocommerce-session\"));\n      }\n    }\n\n    return response;\n  });\n}); // Apollo GraphQL client.\n\nconst client = new ApolloClient({\n  link: middleware.concat(afterware.concat(createHttpLink({\n    uri: `${process.env.NEXT_PUBLIC_WORDPRESS_URL}/graphql`,\n    fetch: fetch\n  }))),\n  cache: new InMemoryCache()\n});\nexport default client;","map":null,"metadata":{},"sourceType":"module"}