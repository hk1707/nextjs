{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport Link from 'next/link';\nimport { useContext, useState } from 'react';\nimport { AppContext } from \"../../context/AppContext\";\nimport { getFormattedCart, getUpdatedItems } from '../../../functions';\nimport CartItem from \"./CartItem\";\nimport { v4 } from 'uuid';\nimport { useMutation, useQuery } from '@apollo/client';\nimport UPDATE_CART from \"../../../mutations/update-cart\";\nimport GET_CART from \"../../../queries/get-cart\";\nimport CLEAR_CART_MUTATION from \"../../../mutations/clear-cart\";\nimport { isEmpty } from 'lodash';\n\nconst CartItemsContainer = () => {\n  // @TODO wil use it in future variations of the project.\n  const {\n    0: cart,\n    1: setCart\n  } = useContext(AppContext);\n  const {\n    0: requestError,\n    1: setRequestError\n  } = useState(null); // Get Cart Data.\n\n  const {\n    loading,\n    error,\n    data,\n    refetch\n  } = useQuery(GET_CART, {\n    notifyOnNetworkStatusChange: true,\n    onCompleted: () => {\n      console.warn('completed GET_CART', data); // Update cart in the localStorage.\n\n      const updatedCart = data;\n      localStorage.setItem('woo-next-cart', JSON.stringify(updatedCart)); // Update cart data in React Context.\n\n      setCart(updatedCart);\n    }\n  }); // Update Cart Mutation.\n\n  const [updateCart, {\n    data: updateCartResponse,\n    loading: updateCartProcessing,\n    error: updateCartError\n  }] = useMutation(UPDATE_CART, {\n    onCompleted: () => {\n      refetch();\n    },\n    onError: error => {\n      if (error) {\n        var _error$graphQLErrors, _error$graphQLErrors$;\n\n        const errorMessage = error !== null && error !== void 0 && (_error$graphQLErrors = error.graphQLErrors) !== null && _error$graphQLErrors !== void 0 && (_error$graphQLErrors$ = _error$graphQLErrors[0]) !== null && _error$graphQLErrors$ !== void 0 && _error$graphQLErrors$.message ? error.graphQLErrors[0].message : '';\n        setRequestError(errorMessage);\n      }\n    }\n  }); // Update Cart Mutation.\n\n  const [clearCart, {\n    data: clearCartRes,\n    loading: clearCartProcessing,\n    error: clearCartError\n  }] = useMutation(CLEAR_CART_MUTATION, {\n    onCompleted: () => {\n      refetch();\n    },\n    onError: error => {\n      if (error) {\n        var _error$graphQLErrors2, _error$graphQLErrors$2;\n\n        const errorMessage = !isEmpty(error === null || error === void 0 ? void 0 : (_error$graphQLErrors2 = error.graphQLErrors) === null || _error$graphQLErrors2 === void 0 ? void 0 : _error$graphQLErrors2[0]) ? (_error$graphQLErrors$2 = error.graphQLErrors[0]) === null || _error$graphQLErrors$2 === void 0 ? void 0 : _error$graphQLErrors$2.message : '';\n        setRequestError(errorMessage);\n      }\n    }\n  });\n  /*\n   * Handle remove product click.\n   *\n   * @param {Object} event event\n   * @param {Integer} Product Id.\n   *\n   * @return {void}\n   */\n\n  const handleRemoveProductClick = (event, cartKey, products) => {\n    event.stopPropagation();\n\n    if (products.length && products.length != 0) {\n      // By passing the newQty to 0 in updateCart Mutation, it will remove the item.\n      const newQty = 0;\n      const updatedItems = getUpdatedItems(products, newQty, cartKey);\n      updateCart({\n        variables: {\n          input: {\n            clientMutationId: v4(),\n            items: updatedItems\n          }\n        }\n      });\n    }\n  }; // Clear the entire cart.\n\n\n  const handleClearCart = event => {\n    event.stopPropagation();\n\n    if (clearCartProcessing) {\n      return;\n    }\n\n    clearCart({\n      variables: {\n        input: {\n          clientMutationId: v4(),\n          all: true\n        }\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: \"cart product-cart-container container mx-auto my-32 px-4 xl:px-0\",\n    children: cart ? /*#__PURE__*/_jsxs(\"div\", {\n      className: \"woo-next-cart-wrapper container\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"cart-header grid grid-cols-2 gap-4\",\n        children: [/*#__PURE__*/_jsx(\"h1\", {\n          className: \"text-2xl mb-5 uppercase\",\n          children: \"Cart\"\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"clear-cart text-right\",\n          children: [/*#__PURE__*/_jsxs(\"button\", {\n            className: \"px-4 py-1 bg-gray-500 text-white rounded-sm w-auto\",\n            onClick: event => handleClearCart(event),\n            disabled: clearCartProcessing,\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              className: \"woo-next-cart\",\n              children: \"Clear Cart\"\n            }), /*#__PURE__*/_jsx(\"i\", {\n              className: \"fa fa-arrow-alt-right\"\n            })]\n          }), clearCartProcessing ? /*#__PURE__*/_jsx(\"p\", {\n            children: \"Clearing...\"\n          }) : '', updateCartProcessing ? /*#__PURE__*/_jsx(\"p\", {\n            children: \"Updating...\"\n          }) : null]\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"grid grid-cols-1 xl:grid-cols-4 gap-0 xl:gap-4 mb-5\",\n        children: [/*#__PURE__*/_jsxs(\"table\", {\n          className: \"cart-products table-auto col-span-3 mb-5\",\n          children: [/*#__PURE__*/_jsx(\"thead\", {\n            className: \"text-left\",\n            children: /*#__PURE__*/_jsxs(\"tr\", {\n              className: \"woo-next-cart-head-container\",\n              children: [/*#__PURE__*/_jsx(\"th\", {\n                className: \"woo-next-cart-heading-el\",\n                scope: \"col\"\n              }), /*#__PURE__*/_jsx(\"th\", {\n                className: \"woo-next-cart-heading-el\",\n                scope: \"col\"\n              }), /*#__PURE__*/_jsx(\"th\", {\n                className: \"woo-next-cart-heading-el\",\n                scope: \"col\",\n                children: \"Product\"\n              }), /*#__PURE__*/_jsx(\"th\", {\n                className: \"woo-next-cart-heading-el\",\n                scope: \"col\",\n                children: \"Price\"\n              }), /*#__PURE__*/_jsx(\"th\", {\n                className: \"woo-next-cart-heading-el\",\n                scope: \"col\",\n                children: \"Quantity\"\n              }), /*#__PURE__*/_jsx(\"th\", {\n                className: \"woo-next-cart-heading-el\",\n                scope: \"col\",\n                children: \"Total\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(\"tbody\", {\n            children: cart.products.length != 0 && cart.products.map(item => /*#__PURE__*/_jsx(CartItem, {\n              item: item,\n              updateCartProcessing: updateCartProcessing,\n              products: cart.products,\n              handleRemoveProductClick: handleRemoveProductClick,\n              updateCart: updateCart\n            }, item.productId))\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"row woo-next-cart-total-container border p-5 bg-gray-200\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"\",\n            children: [/*#__PURE__*/_jsx(\"table\", {\n              className: \"table table-hover mb-5\",\n              children: /*#__PURE__*/_jsxs(\"tbody\", {\n                children: [/*#__PURE__*/_jsxs(\"tr\", {\n                  className: \"table-light flex flex-col\",\n                  children: [/*#__PURE__*/_jsx(\"td\", {\n                    className: \"woo-next-cart-element-total text-2xl font-normal\",\n                    children: \"Subtotal\"\n                  }), /*#__PURE__*/_jsx(\"td\", {\n                    className: \"woo-next-cart-element-amt text-2xl font-bold\",\n                    children: 'string' !== typeof cart.totalProductsPrice ? cart.totalProductsPrice.toFixed(2) : cart.totalProductsPrice\n                  })]\n                }), /*#__PURE__*/_jsxs(\"tr\", {\n                  className: \"table-light\",\n                  children: [/*#__PURE__*/_jsx(\"td\", {\n                    className: \"woo-next-cart-element-total\",\n                    children: \"Total\"\n                  }), /*#__PURE__*/_jsx(\"td\", {\n                    className: \"woo-next-cart-element-amt\",\n                    children: 'string' !== typeof cart.totalProductsPrice ? cart.totalProductsPrice.toFixed(2) : cart.totalProductsPrice\n                  })]\n                })]\n              })\n            }), /*#__PURE__*/_jsx(Link, {\n              href: \"/checkout\",\n              children: /*#__PURE__*/_jsxs(\"button\", {\n                className: \"bg-purple-600 text-white px-5 py-3 rounded-sm w-auto xl:w-full\",\n                children: [/*#__PURE__*/_jsx(\"span\", {\n                  className: \"woo-next-cart-checkout-txt\",\n                  children: \"Proceed to Checkout\"\n                }), /*#__PURE__*/_jsx(\"i\", {\n                  className: \"fas fa-long-arrow-alt-right\"\n                })]\n              })\n            })]\n          })\n        })]\n      }), requestError ? /*#__PURE__*/_jsxs(\"div\", {\n        className: \"row woo-next-cart-total-container mt-5\",\n        children: [\" \", requestError, \" \"]\n      }) : '']\n    }) : /*#__PURE__*/_jsxs(\"div\", {\n      className: \"container mx-auto my-32 px-4 xl:px-0\",\n      children: [/*#__PURE__*/_jsx(\"h2\", {\n        className: \"text-2xl mb-5\",\n        children: \"No items in the cart\"\n      }), /*#__PURE__*/_jsx(Link, {\n        href: \"/\",\n        children: /*#__PURE__*/_jsxs(\"button\", {\n          className: \"bg-purple-600 text-white px-5 py-3 rounded-sm\",\n          children: [/*#__PURE__*/_jsx(\"span\", {\n            className: \"woo-next-cart-checkout-txt\",\n            children: \"Add New Products\"\n          }), /*#__PURE__*/_jsx(\"i\", {\n            className: \"fas fa-long-arrow-alt-right\"\n          })]\n        })\n      })]\n    })\n  });\n};\n\nexport default CartItemsContainer;","map":null,"metadata":{},"sourceType":"module"}