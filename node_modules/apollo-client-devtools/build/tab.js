/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/extension/tab/tab.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/Relay.ts":
/*!**********************!*\
  !*** ./src/Relay.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/*
  The native EventTarget interface is not useable in content scripts in Firefox.
  We import and extend from this simplified class to use the EventTarget functionality we need.
*/
const EventTarget_1 = __importDefault(__webpack_require__(/*! ./extension/EventTarget */ "./src/extension/EventTarget.ts"));
class Relay extends EventTarget_1.default {
    constructor() {
        super(...arguments);
        this.connections = new Map();
        this.addConnection = (name, fn) => {
            function wrappedFn(event) {
                return fn(event.detail);
            }
            ;
            this.addEventListener(name, wrappedFn);
            this.connections.set(name, wrappedFn);
            return () => this.removeConnection(name);
        };
        this.removeConnection = (name) => {
            const fn = this.connections.get(name);
            if (fn) {
                this.removeEventListener(name, fn);
                this.connections.delete(name);
            }
        };
        this.createEvent = (message) => {
            return new CustomEvent(message, { detail: {} });
        };
        this.broadcast = (message) => {
            let event = this.createEvent(message.message);
            if (message === null || message === void 0 ? void 0 : message.to) {
                let destination = message.to;
                event.detail['to'] = destination;
                let nextDestination;
                let remaining;
                // If there are intermediate destinations
                // Example: 'background:tab:window'
                if (destination.includes(':')) {
                    [destination, ...remaining] = message.to.split(':');
                    nextDestination = remaining.join(':');
                }
                if (this.connections.has(destination)) {
                    event = this.createEvent(destination);
                    event.detail['to'] = nextDestination;
                }
            }
            event.detail['message'] = message.message;
            event.detail['payload'] = message.payload;
            this.dispatchEvent(event);
        };
        this.listen = (name, fn) => {
            function wrappedFn(event) {
                return fn(event.detail);
            }
            ;
            this.addEventListener(name, wrappedFn);
            return () => {
                this.removeEventListener(name, wrappedFn);
            };
        };
        this.send = (messageObj) => {
            this.broadcast(messageObj);
        };
        this.forward = (message, newRecipient) => {
            return this.listen(message, messageObj => {
                this.broadcast(Object.assign(Object.assign({}, messageObj), { to: newRecipient }));
            });
        };
    }
}
exports.default = Relay;


/***/ }),

/***/ "./src/extension/EventTarget.ts":
/*!**************************************!*\
  !*** ./src/extension/EventTarget.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
class EventTarget {
    constructor() {
        this.listeners = new Map();
    }
    addEventListener(eventType, callback) {
        const isRegistered = this.listeners.has(eventType);
        if (!isRegistered) {
            this.listeners.set(eventType, new Set());
        }
        const listeners = this.listeners.get(eventType);
        listeners.add(callback);
    }
    removeEventListener(eventType, callback) {
        const isRegistered = this.listeners.has(eventType);
        if (isRegistered) {
            const listeners = this.listeners.get(eventType);
            listeners.delete(callback);
        }
    }
    dispatchEvent(event) {
        const isRegistered = this.listeners.has(event === null || event === void 0 ? void 0 : event.type);
        if (isRegistered) {
            const listeners = this.listeners.get(event.type);
            listeners.forEach(listener => listener(event));
        }
    }
}
exports.default = EventTarget;


/***/ }),

/***/ "./src/extension/constants.ts":
/*!************************************!*\
  !*** ./src/extension/constants.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.RELOAD_TAB_COMPLETE = exports.RELOADING_TAB = exports.GRAPHIQL_RESPONSE = exports.GRAPHIQL_REQUEST = exports.PANEL_CLOSED = exports.PANEL_OPEN = exports.UPDATE = exports.REQUEST_DATA = exports.ACTION_HOOK_FIRED = exports.CREATE_DEVTOOLS_PANEL = exports.APOLLO_CLIENT_FOUND = exports.FIND_APOLLO_CLIENT = exports.DEVTOOLS_INITIALIZED = exports.REQUEST_TAB_ID = exports.CLIENT_FOUND = void 0;
exports.CLIENT_FOUND = 'client-found';
exports.REQUEST_TAB_ID = 'request-tab-id';
exports.DEVTOOLS_INITIALIZED = 'devtools-initialized';
exports.FIND_APOLLO_CLIENT = 'find-apollo-client';
exports.APOLLO_CLIENT_FOUND = 'apollo-client-found';
exports.CREATE_DEVTOOLS_PANEL = 'create-devtools-panel';
exports.ACTION_HOOK_FIRED = 'action-hook-fired';
exports.REQUEST_DATA = 'request-data';
exports.UPDATE = 'update';
exports.PANEL_OPEN = 'panel-open';
exports.PANEL_CLOSED = 'panel-closed';
exports.GRAPHIQL_REQUEST = 'graphiql-request';
exports.GRAPHIQL_RESPONSE = 'graphiql-response';
exports.RELOADING_TAB = 'reloading-tab';
exports.RELOAD_TAB_COMPLETE = 'reload-tab-complete';


/***/ }),

/***/ "./src/extension/tab/tab.ts":
/*!**********************************!*\
  !*** ./src/extension/tab/tab.ts ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
// This script is injected into each tab.
__webpack_require__(/*! ./tabRelay */ "./src/extension/tab/tabRelay.ts");
/*
  Content scripts are unable to modify the window object directly.
  A common workaround for this issue is to inject an inlined function
  into the inspected tab.
*/
if (typeof document === "object" && document instanceof HTMLDocument) {
    const script = document.createElement("script");
    script.setAttribute("type", "module");
    script.setAttribute("src", chrome.extension.getURL("hook.js"));
    const head = document.head || document.getElementsByTagName("head")[0] || document.documentElement;
    head.insertBefore(script, head.lastChild);
}


/***/ }),

/***/ "./src/extension/tab/tabRelay.ts":
/*!***************************************!*\
  !*** ./src/extension/tab/tabRelay.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Relay_1 = __importDefault(__webpack_require__(/*! ../../Relay */ "./src/Relay.ts"));
const constants_1 = __webpack_require__(/*! ../constants */ "./src/extension/constants.ts");
// Inspected tabs are unable to retrieve their own ids.
// This requests the tab's id from the background script.
// Once it resolves, we can create the tab's Relay.
function requestId() {
    return new Promise(resolve => {
        chrome.runtime.sendMessage({ message: constants_1.REQUEST_TAB_ID }, function (id) {
            resolve(id);
        });
    });
}
exports.default = new Promise(($export) => __awaiter(void 0, void 0, void 0, function* () {
    const id = yield requestId();
    const tab = new Relay_1.default();
    const port = chrome.runtime.connect({
        name: `tab-${id}`,
    });
    tab.addConnection('background', message => {
        port.postMessage(message);
    });
    port.onMessage.addListener(tab.broadcast);
    window.addEventListener('message', event => {
        tab.broadcast(event === null || event === void 0 ? void 0 : event.data);
    });
    tab.addConnection('client', message => {
        window.postMessage(message, '*');
    });
    const devtools = `background:devtools-${id}`;
    tab.forward(constants_1.CLIENT_FOUND, devtools);
    tab.forward(constants_1.CREATE_DEVTOOLS_PANEL, devtools);
    tab.forward(constants_1.ACTION_HOOK_FIRED, devtools);
    tab.forward(constants_1.UPDATE, devtools);
    tab.forward(constants_1.RELOADING_TAB, devtools);
    tab.forward(constants_1.RELOAD_TAB_COMPLETE, devtools);
    tab.forward(constants_1.GRAPHIQL_RESPONSE, `${devtools}:graphiql`);
    const module = yield Promise.resolve({ tab, id });
    $export(module);
}));


/***/ })

/******/ });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL1JlbGF5LnRzIiwid2VicGFjazovLy8uL3NyYy9leHRlbnNpb24vRXZlbnRUYXJnZXQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2V4dGVuc2lvbi9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2V4dGVuc2lvbi90YWIvdGFiLnRzIiwid2VicGFjazovLy8uL3NyYy9leHRlbnNpb24vdGFiL3RhYlJlbGF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7UUFBQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7UUFDQTs7O1FBR0E7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7UUFDQTtRQUNBLDBDQUEwQyxnQ0FBZ0M7UUFDMUU7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQSx3REFBd0Qsa0JBQWtCO1FBQzFFO1FBQ0EsaURBQWlELGNBQWM7UUFDL0Q7O1FBRUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBLHlDQUF5QyxpQ0FBaUM7UUFDMUUsZ0hBQWdILG1CQUFtQixFQUFFO1FBQ3JJO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0EsMkJBQTJCLDBCQUEwQixFQUFFO1FBQ3ZELGlDQUFpQyxlQUFlO1FBQ2hEO1FBQ0E7UUFDQTs7UUFFQTtRQUNBLHNEQUFzRCwrREFBK0Q7O1FBRXJIO1FBQ0E7OztRQUdBO1FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ2xGQTs7O0VBR0U7QUFDRiw0SEFBa0Q7QUFFbEQsTUFBTSxLQUFNLFNBQVEscUJBQVc7SUFBL0I7O1FBQ1UsZ0JBQVcsR0FBRyxJQUFJLEdBQUcsRUFBK0UsQ0FBQztRQUV0RyxrQkFBYSxHQUFHLENBQUMsSUFBWSxFQUFF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RUFBRSxHQUFHLFFBQVEsV0FBVyxDQUFDLENBQUM7SUFFdkQsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDbEQsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ2xCLENBQUMsRUFBQyxDQUFDIiwiZmlsZSI6InRhYi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSBcIi4vc3JjL2V4dGVuc2lvbi90YWIvdGFiLnRzXCIpO1xuIiwiLyogXG4gIFRoZSBuYXRpdmUgRXZlbnRUYXJnZXQgaW50ZXJmYWNlIGlzIG5vdCB1c2VhYmxlIGluIGNvbnRlbnQgc2NyaXB0cyBpbiBGaXJlZm94LiBcbiAgV2UgaW1wb3J0IGFuZCBleHRlbmQgZnJvbSB0aGlzIHNpbXBsaWZpZWQgY2xhc3MgdG8gdXNlIHRoZSBFdmVudFRhcmdldCBmdW5jdGlvbmFsaXR5IHdlIG5lZWQuXG4qL1xuaW1wb3J0IEV2ZW50VGFyZ2V0IGZyb20gJy4vZXh0ZW5zaW9uL0V2ZW50VGFyZ2V0JztcbmltcG9ydCB7IEN1c3RvbUV2ZW50TGlzdGVuZXIsIE1lc3NhZ2VPYmogfSBmcm9tICcuL3R5cGVzJztcbmNsYXNzIFJlbGF5IGV4dGVuZHMgRXZlbnRUYXJnZXQge1xuICBwcml2YXRlIGNvbm5lY3Rpb25zID0gbmV3IE1hcDxzdHJpbmcsIChldmVudDogQ3VzdG9tRXZlbnQ8TWVzc2FnZU9iaj4pID0+IFJldHVyblR5cGU8Q3VzdG9tRXZlbnRMaXN0ZW5lcj4+KCk7XG5cbiAgcHVibGljIGFkZENvbm5lY3Rpb24gPSAobmFtZTogc3RyaW5nLCBmbjogKG1lc3NhZ2U6IE1lc3NhZ2VPYmopID0+IHZvaWQpID0+IHtcbiAgICBmdW5jdGlvbiB3cmFwcGVkRm4oZXZlbnQ6IEN1c3RvbUV2ZW50PE1lc3NhZ2VPYmo+KSB7IFxuICAgICAgcmV0dXJuIGZuKGV2ZW50LmRldGFpbCk7IFxuICAgIH07XG5cbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgd3JhcHBlZEZuKTtcbiAgICB0aGlzLmNvbm5lY3Rpb25zLnNldChuYW1lLCB3cmFwcGVkRm4pO1xuXG4gICAgcmV0dXJuICgpID0+IHRoaXMucmVtb3ZlQ29ubmVjdGlvbihuYW1lKTtcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVDb25uZWN0aW9uID0gKG5hbWU6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IGZuID0gdGhpcy5jb25uZWN0aW9ucy5nZXQobmFtZSk7XG4gICAgaWYgKGZuKSB7XG4gICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgZm4pO1xuICAgICAgdGhpcy5jb25uZWN0aW9ucy5kZWxldGUobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFdmVudCA9IChtZXNzYWdlOiBzdHJpbmcpID0+IHtcbiAgICByZXR1cm4gbmV3IEN1c3RvbUV2ZW50KG1lc3NhZ2UsIHsgZGV0YWlsOiB7fSB9KTtcbiAgfVxuXG4gIHB1YmxpYyBicm9hZGNhc3QgPSAobWVzc2FnZTogTWVzc2FnZU9iaikgPT4ge1xuICAgIGxldCBldmVudCA9IHRoaXMuY3JlYXRlRXZlbnQobWVzc2FnZS5tZXNzYWdlKTtcbiAgICBcbiAgICBpZiAobWVzc2FnZT8udG8pIHtcbiAgICAgIGxldCBkZXN0aW5hdGlvbiA9IG1lc3NhZ2UudG87XG4gICAgICBldmVudC5kZXRhaWxbJ3RvJ10gPSBkZXN0aW5hdGlvbjtcbiAgICAgIGxldCBuZXh0RGVzdGluYXRpb246IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgIGxldCByZW1haW5pbmc6IHN0cmluZ1tdO1xuICAgICAgXG4gICAgICAvLyBJZiB0aGVyZSBhcmUgaW50ZXJtZWRpYXRlIGRlc3RpbmF0aW9uc1xuICAgICAgLy8gRXhhbXBsZTogJ2JhY2tncm91bmQ6dGFiOndpbmRvdydcbiAgICAgIGlmIChkZXN0aW5hdGlvbi5pbmNsdWRlcygnOicpKSB7XG4gICAgICAgIFtkZXN0aW5hdGlvbiwgLi4ucmVtYWluaW5nXSA9IG1lc3NhZ2UudG8uc3BsaXQoJzonKTtcbiAgICAgICAgbmV4dERlc3RpbmF0aW9uID0gcmVtYWluaW5nLmpvaW4oJzonKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbnMuaGFzKGRlc3RpbmF0aW9uKSkge1xuICAgICAgICBldmVudCA9IHRoaXMuY3JlYXRlRXZlbnQoZGVzdGluYXRpb24pO1xuICAgICAgICBldmVudC5kZXRhaWxbJ3RvJ10gPSBuZXh0RGVzdGluYXRpb247XG4gICAgICB9XG4gICAgfVxuXG4gICAgZXZlbnQuZGV0YWlsWydtZXNzYWdlJ10gPSBtZXNzYWdlLm1lc3NhZ2U7XG4gICAgZXZlbnQuZGV0YWlsWydwYXlsb2FkJ10gPSBtZXNzYWdlLnBheWxvYWQ7XG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgfVxuXG4gIHB1YmxpYyBsaXN0ZW4gPSA8VCA9IGFueT4obmFtZTogc3RyaW5nLCBmbjogQ3VzdG9tRXZlbnRMaXN0ZW5lcjxUPikgPT4ge1xuICAgIGZ1bmN0aW9uIHdyYXBwZWRGbihldmVudDogQ3VzdG9tRXZlbnQ8TWVzc2FnZU9iajxUPj4pIHsgXG4gICAgICByZXR1cm4gZm4oZXZlbnQuZGV0YWlsKTsgXG4gICAgfTtcblxuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLCB3cmFwcGVkRm4pO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIobmFtZSwgd3JhcHBlZEZuKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2VuZCA9IChtZXNzYWdlT2JqOiBNZXNzYWdlT2JqKSA9PiB7XG4gICAgdGhpcy5icm9hZGNhc3QobWVzc2FnZU9iaik7XG4gIH1cblxuICBwdWJsaWMgZm9yd2FyZCA9IChtZXNzYWdlOiBzdHJpbmcsIG5ld1JlY2lwaWVudDogc3RyaW5nKSAgPT4ge1xuICAgIHJldHVybiB0aGlzLmxpc3RlbihtZXNzYWdlLCBtZXNzYWdlT2JqID0+IHtcbiAgICAgIHRoaXMuYnJvYWRjYXN0KHtcbiAgICAgICAgLi4ubWVzc2FnZU9iaixcbiAgICAgICAgdG86IG5ld1JlY2lwaWVudCxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJlbGF5O1xuIiwiaW1wb3J0IHsgTWVzc2FnZU9iaiB9IGZyb20gJy4uL3R5cGVzJztcblxuZXhwb3J0IHR5cGUgRXZlbnRMaXN0ZW5lcjxUID0gYW55PiA9IChldmVudDogQ3VzdG9tRXZlbnQ8TWVzc2FnZU9iajxUPj4pID0+IHZvaWQ7XG5cbmNsYXNzIEV2ZW50VGFyZ2V0IHtcbiAgbGlzdGVuZXJzID0gbmV3IE1hcDxzdHJpbmcsIFNldDxFdmVudExpc3RlbmVyPj4oKTtcblxuICBhZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZTogc3RyaW5nLCBjYWxsYmFjazogRXZlbnRMaXN0ZW5lcikge1xuICAgIGNvbnN0IGlzUmVnaXN0ZXJlZCA9IHRoaXMubGlzdGVuZXJzLmhhcyhldmVudFR5cGUpO1xuICAgIFxuICAgIGlmICghaXNSZWdpc3RlcmVkKSB7XG4gICAgICB0aGlzLmxpc3RlbmVycy5zZXQoZXZlbnRUeXBlLCBuZXcgU2V0PEV2ZW50TGlzdGVuZXI+KCkpO1xuICAgIH1cblxuICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMubGlzdGVuZXJzLmdldChldmVudFR5cGUpO1xuICAgIGxpc3RlbmVycyEuYWRkKGNhbGxiYWNrKTtcbiAgfVxuXG4gIHJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlOiBzdHJpbmcsIGNhbGxiYWNrKSB7XG4gICAgY29uc3QgaXNSZWdpc3RlcmVkID0gdGhpcy5saXN0ZW5lcnMuaGFzKGV2ZW50VHlwZSk7XG5cbiAgICBpZiAoaXNSZWdpc3RlcmVkKSB7XG4gICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQoZXZlbnRUeXBlKTtcbiAgICAgIGxpc3RlbmVycyEuZGVsZXRlKGNhbGxiYWNrKTtcbiAgICB9XG4gIH1cblxuICBkaXNwYXRjaEV2ZW50KGV2ZW50OiBDdXN0b21FdmVudCkge1xuICAgIGNvbnN0IGlzUmVnaXN0ZXJlZCA9IHRoaXMubGlzdGVuZXJzLmhhcyhldmVudD8udHlwZSk7XG5cbiAgICBpZiAoaXNSZWdpc3RlcmVkKSB7XG4gICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQoZXZlbnQudHlwZSk7XG4gICAgICBsaXN0ZW5lcnMhLmZvckVhY2gobGlzdGVuZXIgPT4gbGlzdGVuZXIoZXZlbnQpKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRXZlbnRUYXJnZXQ7XG5cblxuIiwiZXhwb3J0IGNvbnN0IENMSUVOVF9GT1VORCA9ICdjbGllbnQtZm91bmQnO1xuZXhwb3J0IGNvbnN0IFJFUVVFU1RfVEFCX0lEID0gJ3JlcXVlc3QtdGFiLWlkJztcbmV4cG9ydCBjb25zdCBERVZUT09MU19JTklUSUFMSVpFRCA9ICdkZXZ0b29scy1pbml0aWFsaXplZCc7XG5leHBvcnQgY29uc3QgRklORF9BUE9MTE9fQ0xJRU5UID0gJ2ZpbmQtYXBvbGxvLWNsaWVudCc7XG5leHBvcnQgY29uc3QgQVBPTExPX0NMSUVOVF9GT1VORCA9ICdhcG9sbG8tY2xpZW50LWZvdW5kJztcbmV4cG9ydCBjb25zdCBDUkVBVEVfREVWVE9PTFNfUEFORUwgPSAnY3JlYXRlLWRldnRvb2xzLXBhbmVsJztcbmV4cG9ydCBjb25zdCBBQ1RJT05fSE9PS19GSVJFRCA9ICdhY3Rpb24taG9vay1maXJlZCc7XG5leHBvcnQgY29uc3QgUkVRVUVTVF9EQVRBID0gJ3JlcXVlc3QtZGF0YSc7XG5leHBvcnQgY29uc3QgVVBEQVRFID0gJ3VwZGF0ZSc7XG5leHBvcnQgY29uc3QgUEFORUxfT1BFTiA9ICdwYW5lbC1vcGVuJztcbmV4cG9ydCBjb25zdCBQQU5FTF9DTE9TRUQgPSAncGFuZWwtY2xvc2VkJztcbmV4cG9ydCBjb25zdCBHUkFQSElRTF9SRVFVRVNUID0gJ2dyYXBoaXFsLXJlcXVlc3QnO1xuZXhwb3J0IGNvbnN0IEdSQVBISVFMX1JFU1BPTlNFID0gJ2dyYXBoaXFsLXJlc3BvbnNlJztcbmV4cG9ydCBjb25zdCBSRUxPQURJTkdfVEFCID0gJ3JlbG9hZGluZy10YWInO1xuZXhwb3J0IGNvbnN0IFJFTE9BRF9UQUJfQ09NUExFVEUgPSAncmVsb2FkLXRhYi1jb21wbGV0ZSc7XG4iLCIvLyBUaGlzIHNjcmlwdCBpcyBpbmplY3RlZCBpbnRvIGVhY2ggdGFiLlxuaW1wb3J0IFwiLi90YWJSZWxheVwiOyBcblxuLyogXG4gIENvbnRlbnQgc2NyaXB0cyBhcmUgdW5hYmxlIHRvIG1vZGlmeSB0aGUgd2luZG93IG9iamVjdCBkaXJlY3RseS4gXG4gIEEgY29tbW9uIHdvcmthcm91bmQgZm9yIHRoaXMgaXNzdWUgaXMgdG8gaW5qZWN0IGFuIGlubGluZWQgZnVuY3Rpb25cbiAgaW50byB0aGUgaW5zcGVjdGVkIHRhYi5cbiovIFxuaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gXCJvYmplY3RcIiAmJiBkb2N1bWVudCBpbnN0YW5jZW9mIEhUTUxEb2N1bWVudCkge1xuICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICBzY3JpcHQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcIm1vZHVsZVwiKTtcbiAgc2NyaXB0LnNldEF0dHJpYnV0ZShcInNyY1wiLCBjaHJvbWUuZXh0ZW5zaW9uLmdldFVSTChcImhvb2suanNcIikpO1xuICBjb25zdCBoZWFkID0gZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0gfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICBoZWFkLmluc2VydEJlZm9yZShzY3JpcHQsIGhlYWQubGFzdENoaWxkKTtcbn1cbiIsImltcG9ydCBSZWxheSBmcm9tICcuLi8uLi9SZWxheSc7XG5pbXBvcnQgeyBcbiAgQ0xJRU5UX0ZPVU5ELFxuICBSRVFVRVNUX1RBQl9JRCwgXG4gIENSRUFURV9ERVZUT09MU19QQU5FTCxcbiAgQUNUSU9OX0hPT0tfRklSRUQsXG4gIEdSQVBISVFMX1JFU1BPTlNFLFxuICBVUERBVEUsXG4gIFJFTE9BRElOR19UQUIsXG4gIFJFTE9BRF9UQUJfQ09NUExFVEUsXG59IGZyb20gJy4uL2NvbnN0YW50cyc7XG5cbi8vIEluc3BlY3RlZCB0YWJzIGFyZSB1bmFibGUgdG8gcmV0cmlldmUgdGhlaXIgb3duIGlkcy5cbi8vIFRoaXMgcmVxdWVzdHMgdGhlIHRhYidzIGlkIGZyb20gdGhlIGJhY2tncm91bmQgc2NyaXB0LlxuLy8gT25jZSBpdCByZXNvbHZlcywgd2UgY2FuIGNyZWF0ZSB0aGUgdGFiJ3MgUmVsYXkuXG5mdW5jdGlvbiByZXF1ZXN0SWQoKXtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHsgbWVzc2FnZTogUkVRVUVTVF9UQUJfSUQgfSwgZnVuY3Rpb24oaWQpIHtcbiAgICAgIHJlc29sdmUoaWQpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgbmV3IFByb21pc2UoYXN5bmMgJGV4cG9ydCA9PiB7XG4gIGNvbnN0IGlkID0gYXdhaXQgcmVxdWVzdElkKCk7XG4gIGNvbnN0IHRhYiA9IG5ldyBSZWxheSgpO1xuICBjb25zdCBwb3J0ID0gY2hyb21lLnJ1bnRpbWUuY29ubmVjdCh7XG4gICAgbmFtZTogYHRhYi0ke2lkfWAsXG4gIH0pO1xuXG4gIHRhYi5hZGRDb25uZWN0aW9uKCdiYWNrZ3JvdW5kJywgbWVzc2FnZSA9PiB7XG4gICAgcG9ydC5wb3N0TWVzc2FnZShtZXNzYWdlKTtcbiAgfSk7XG5cbiAgcG9ydC5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIodGFiLmJyb2FkY2FzdCk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBldmVudCA9PiB7XG4gICAgdGFiLmJyb2FkY2FzdChldmVudD8uZGF0YSk7XG4gIH0pO1xuXG4gIHRhYi5hZGRDb25uZWN0aW9uKCdjbGllbnQnLCBtZXNzYWdlID0+IHtcbiAgICB3aW5kb3cucG9zdE1lc3NhZ2UobWVzc2FnZSwgJyonKTtcbiAgfSk7XG5cbiAgY29uc3QgZGV2dG9vbHMgPSBgYmFja2dyb3VuZDpkZXZ0b29scy0ke2lkfWA7XG4gIHRhYi5mb3J3YXJkKENMSUVOVF9GT1VORCwgZGV2dG9vbHMpO1xuICB0YWIuZm9yd2FyZChDUkVBVEVfREVWVE9PTFNfUEFORUwsIGRldnRvb2xzKTtcbiAgdGFiLmZvcndhcmQoQUNUSU9OX0hPT0tfRklSRUQsIGRldnRvb2xzKTtcbiAgdGFiLmZvcndhcmQoVVBEQVRFLCBkZXZ0b29scyk7XG4gIHRhYi5mb3J3YXJkKFJFTE9BRElOR19UQUIsIGRldnRvb2xzKTtcbiAgdGFiLmZvcndhcmQoUkVMT0FEX1RBQl9DT01QTEVURSwgZGV2dG9vbHMpO1xuICB0YWIuZm9yd2FyZChHUkFQSElRTF9SRVNQT05TRSwgYCR7ZGV2dG9vbHN9OmdyYXBoaXFsYCk7XG5cbiAgY29uc3QgbW9kdWxlID0gYXdhaXQgUHJvbWlzZS5yZXNvbHZlKHsgdGFiLCBpZCB9KTtcbiAgJGV4cG9ydChtb2R1bGUpO1xufSk7XG4iXSwic291cmNlUm9vdCI6IiJ9