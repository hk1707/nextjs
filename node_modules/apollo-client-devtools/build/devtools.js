/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/extension/devtools/devtools.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./src/Relay.ts":
/*!**********************!*\
  !*** ./src/Relay.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/*
  The native EventTarget interface is not useable in content scripts in Firefox.
  We import and extend from this simplified class to use the EventTarget functionality we need.
*/
const EventTarget_1 = __importDefault(__webpack_require__(/*! ./extension/EventTarget */ "./src/extension/EventTarget.ts"));
class Relay extends EventTarget_1.default {
    constructor() {
        super(...arguments);
        this.connections = new Map();
        this.addConnection = (name, fn) => {
            function wrappedFn(event) {
                return fn(event.detail);
            }
            ;
            this.addEventListener(name, wrappedFn);
            this.connections.set(name, wrappedFn);
            return () => this.removeConnection(name);
        };
        this.removeConnection = (name) => {
            const fn = this.connections.get(name);
            if (fn) {
                this.removeEventListener(name, fn);
                this.connections.delete(name);
            }
        };
        this.createEvent = (message) => {
            return new CustomEvent(message, { detail: {} });
        };
        this.broadcast = (message) => {
            let event = this.createEvent(message.message);
            if (message === null || message === void 0 ? void 0 : message.to) {
                let destination = message.to;
                event.detail['to'] = destination;
                let nextDestination;
                let remaining;
                // If there are intermediate destinations
                // Example: 'background:tab:window'
                if (destination.includes(':')) {
                    [destination, ...remaining] = message.to.split(':');
                    nextDestination = remaining.join(':');
                }
                if (this.connections.has(destination)) {
                    event = this.createEvent(destination);
                    event.detail['to'] = nextDestination;
                }
            }
            event.detail['message'] = message.message;
            event.detail['payload'] = message.payload;
            this.dispatchEvent(event);
        };
        this.listen = (name, fn) => {
            function wrappedFn(event) {
                return fn(event.detail);
            }
            ;
            this.addEventListener(name, wrappedFn);
            return () => {
                this.removeEventListener(name, wrappedFn);
            };
        };
        this.send = (messageObj) => {
            this.broadcast(messageObj);
        };
        this.forward = (message, newRecipient) => {
            return this.listen(message, messageObj => {
                this.broadcast(Object.assign(Object.assign({}, messageObj), { to: newRecipient }));
            });
        };
    }
}
exports.default = Relay;


/***/ }),

/***/ "./src/extension/EventTarget.ts":
/*!**************************************!*\
  !*** ./src/extension/EventTarget.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
class EventTarget {
    constructor() {
        this.listeners = new Map();
    }
    addEventListener(eventType, callback) {
        const isRegistered = this.listeners.has(eventType);
        if (!isRegistered) {
            this.listeners.set(eventType, new Set());
        }
        const listeners = this.listeners.get(eventType);
        listeners.add(callback);
    }
    removeEventListener(eventType, callback) {
        const isRegistered = this.listeners.has(eventType);
        if (isRegistered) {
            const listeners = this.listeners.get(eventType);
            listeners.delete(callback);
        }
    }
    dispatchEvent(event) {
        const isRegistered = this.listeners.has(event === null || event === void 0 ? void 0 : event.type);
        if (isRegistered) {
            const listeners = this.listeners.get(event.type);
            listeners.forEach(listener => listener(event));
        }
    }
}
exports.default = EventTarget;


/***/ }),

/***/ "./src/extension/constants.ts":
/*!************************************!*\
  !*** ./src/extension/constants.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.RELOAD_TAB_COMPLETE = exports.RELOADING_TAB = exports.GRAPHIQL_RESPONSE = exports.GRAPHIQL_REQUEST = exports.PANEL_CLOSED = exports.PANEL_OPEN = exports.UPDATE = exports.REQUEST_DATA = exports.ACTION_HOOK_FIRED = exports.CREATE_DEVTOOLS_PANEL = exports.APOLLO_CLIENT_FOUND = exports.FIND_APOLLO_CLIENT = exports.DEVTOOLS_INITIALIZED = exports.REQUEST_TAB_ID = exports.CLIENT_FOUND = void 0;
exports.CLIENT_FOUND = 'client-found';
exports.REQUEST_TAB_ID = 'request-tab-id';
exports.DEVTOOLS_INITIALIZED = 'devtools-initialized';
exports.FIND_APOLLO_CLIENT = 'find-apollo-client';
exports.APOLLO_CLIENT_FOUND = 'apollo-client-found';
exports.CREATE_DEVTOOLS_PANEL = 'create-devtools-panel';
exports.ACTION_HOOK_FIRED = 'action-hook-fired';
exports.REQUEST_DATA = 'request-data';
exports.UPDATE = 'update';
exports.PANEL_OPEN = 'panel-open';
exports.PANEL_CLOSED = 'panel-closed';
exports.GRAPHIQL_REQUEST = 'graphiql-request';
exports.GRAPHIQL_RESPONSE = 'graphiql-response';
exports.RELOADING_TAB = 'reloading-tab';
exports.RELOAD_TAB_COMPLETE = 'reload-tab-complete';


/***/ }),

/***/ "./src/extension/devtools/devtools.ts":
/*!********************************************!*\
  !*** ./src/extension/devtools/devtools.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Relay_1 = __importDefault(__webpack_require__(/*! ../../Relay */ "./src/Relay.ts"));
const constants_1 = __webpack_require__(/*! ../constants */ "./src/extension/constants.ts");
const inspectedTabId = chrome.devtools.inspectedWindow.tabId;
const devtools = new Relay_1.default();
const port = chrome.runtime.connect({
    name: `devtools-${inspectedTabId}`,
});
port.onMessage.addListener(devtools.broadcast);
devtools.addConnection('background', message => {
    port.postMessage(message);
});
function sendMessageToClient(message) {
    devtools.send({
        message,
        to: `background:tab-${inspectedTabId}:client`
    });
}
function startRequestInterval(ms = 500) {
    sendMessageToClient(constants_1.REQUEST_DATA);
    const id = setInterval(sendMessageToClient, ms, constants_1.REQUEST_DATA);
    return () => clearInterval(id);
}
sendMessageToClient(constants_1.DEVTOOLS_INITIALIZED);
let isPanelCreated = false;
let isAppInitialized = false;
devtools.listen(constants_1.CREATE_DEVTOOLS_PANEL, ({ payload }) => {
    if (!isPanelCreated) {
        chrome.devtools.panels.create('Apollo', 'logo_devtools.png', 'panel.html', function (panel) {
            isPanelCreated = true;
            const { queries, mutations, cache } = JSON.parse(payload);
            let removeUpdateListener;
            let removeGraphiQLForward;
            let removeReloadListener;
            let clearRequestInterval;
            let removeGraphiQLListener;
            panel.onShown.addListener(window => {
                sendMessageToClient(constants_1.PANEL_OPEN);
                const { __DEVTOOLS_APPLICATION__: { initialize, writeData, receiveGraphiQLRequests, sendResponseToGraphiQL, handleReload, handleReloadComplete, } } = window;
                if (!isAppInitialized) {
                    initialize();
                    writeData({ queries, mutations, cache: JSON.stringify(cache) });
                    isAppInitialized = true;
                }
                clearRequestInterval = startRequestInterval();
                removeUpdateListener = devtools.listen(constants_1.UPDATE, ({ payload }) => {
                    const { queries, mutations, cache } = JSON.parse(payload);
                    writeData({ queries, mutations, cache: JSON.stringify(cache) });
                });
                // Add connection so client can send to `background:devtools-${inspectedTabId}:graphiql`
                devtools.addConnection('graphiql', sendResponseToGraphiQL);
                removeGraphiQLListener = receiveGraphiQLRequests(({ detail }) => {
                    devtools.broadcast(detail);
                });
                // Forward all GraphiQL requests to the client
                removeGraphiQLForward = devtools.forward(constants_1.GRAPHIQL_REQUEST, `background:tab-${inspectedTabId}:client`);
                // Listen for tab reload from background
                removeReloadListener = devtools.listen(constants_1.RELOADING_TAB, () => {
                    handleReload();
                    clearRequestInterval();
                    const removeListener = devtools.listen(constants_1.RELOAD_TAB_COMPLETE, () => {
                        clearRequestInterval = startRequestInterval();
                        handleReloadComplete();
                        removeListener();
                    });
                });
            });
            panel.onHidden.addListener(() => {
                isPanelCreated = false;
                clearRequestInterval();
                removeGraphiQLForward();
                removeUpdateListener();
                removeReloadListener();
                removeGraphiQLListener();
                devtools.removeConnection('graphiql');
                sendMessageToClient(constants_1.PANEL_CLOSED);
            });
        });
    }
});


/***/ })

/******/ });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL1JlbGF5LnRzIiwid2VicGFjazovLy8uL3NyYy9leHRlbnNpb24vRXZlbnRUYXJnZXQudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2V4dGVuc2lvbi9jb25zdGFudHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2V4dGVuc2lvbi9kZXZ0b29scy9kZXZ0b29scy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO1FBQUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7OztRQUdBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQSwwQ0FBMEMsZ0NBQWdDO1FBQzFFO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0Esd0RBQXdELGtCQUFrQjtRQUMxRTtRQUNBLGlEQUFpRCxjQUFjO1FBQy9EOztRQUVBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQSx5Q0FBeUMsaUNBQWlDO1FBQzFFLGdIQUFnSCxtQkFBbUIsRUFBRTtRQUNySTtRQUNBOztRQUVBO1FBQ0E7UUFDQTtRQUNBLDJCQUEyQiwwQkFBMEIsRUFBRTtRQUN2RCxpQ0FBaUMsZUFBZTtRQUNoRDtRQUNBO1FBQ0E7O1FBRUE7UUFDQSxzREFBc0QsK0RBQStEOztRQUVySDtRQUNBOzs7UUFHQTtRQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNsRkE7OztFQUdFO0FBQ0YsNEhBQWtEO0FBRWxELE1BQU0sS0FBTSxTQUFRLHFCQUFXO0lBQS9COztRQUNVLGdCQUFXLEdBQUcsSUFBSSxHQUFHLEVBQStFLENBQUM7UUFFdEcsa0JBQWEsR0FBRyxDQUFDLElBQVksRUFBRSxFQUFpQyxFQUFFLEVBQUU7WUFDekUsU0FBUyxTQUFTLENB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QUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ3RDLG1CQUFtQixDQUFDLHdCQUFZLENBQUMsQ0FBQztZQUNwQyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FDRixDQUFDO0tBQ0g7QUFDSCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJkZXZ0b29scy5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSBcIi4vc3JjL2V4dGVuc2lvbi9kZXZ0b29scy9kZXZ0b29scy50c1wiKTtcbiIsIi8qIFxuICBUaGUgbmF0aXZlIEV2ZW50VGFyZ2V0IGludGVyZmFjZSBpcyBub3QgdXNlYWJsZSBpbiBjb250ZW50IHNjcmlwdHMgaW4gRmlyZWZveC4gXG4gIFdlIGltcG9ydCBhbmQgZXh0ZW5kIGZyb20gdGhpcyBzaW1wbGlmaWVkIGNsYXNzIHRvIHVzZSB0aGUgRXZlbnRUYXJnZXQgZnVuY3Rpb25hbGl0eSB3ZSBuZWVkLlxuKi9cbmltcG9ydCBFdmVudFRhcmdldCBmcm9tICcuL2V4dGVuc2lvbi9FdmVudFRhcmdldCc7XG5pbXBvcnQgeyBDdXN0b21FdmVudExpc3RlbmVyLCBNZXNzYWdlT2JqIH0gZnJvbSAnLi90eXBlcyc7XG5jbGFzcyBSZWxheSBleHRlbmRzIEV2ZW50VGFyZ2V0IHtcbiAgcHJpdmF0ZSBjb25uZWN0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCAoZXZlbnQ6IEN1c3RvbUV2ZW50PE1lc3NhZ2VPYmo+KSA9PiBSZXR1cm5UeXBlPEN1c3RvbUV2ZW50TGlzdGVuZXI+PigpO1xuXG4gIHB1YmxpYyBhZGRDb25uZWN0aW9uID0gKG5hbWU6IHN0cmluZywgZm46IChtZXNzYWdlOiBNZXNzYWdlT2JqKSA9PiB2b2lkKSA9PiB7XG4gICAgZnVuY3Rpb24gd3JhcHBlZEZuKGV2ZW50OiBDdXN0b21FdmVudDxNZXNzYWdlT2JqPikgeyBcbiAgICAgIHJldHVybiBmbihldmVudC5kZXRhaWwpOyBcbiAgICB9O1xuXG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKG5hbWUsIHdyYXBwZWRGbik7XG4gICAgdGhpcy5jb25uZWN0aW9ucy5zZXQobmFtZSwgd3JhcHBlZEZuKTtcblxuICAgIHJldHVybiAoKSA9PiB0aGlzLnJlbW92ZUNvbm5lY3Rpb24obmFtZSk7XG4gIH1cblxuICBwdWJsaWMgcmVtb3ZlQ29ubmVjdGlvbiA9IChuYW1lOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBmbiA9IHRoaXMuY29ubmVjdGlvbnMuZ2V0KG5hbWUpO1xuICAgIGlmIChmbikge1xuICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIGZuKTtcbiAgICAgIHRoaXMuY29ubmVjdGlvbnMuZGVsZXRlKG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRXZlbnQgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBDdXN0b21FdmVudChtZXNzYWdlLCB7IGRldGFpbDoge30gfSk7XG4gIH1cblxuICBwdWJsaWMgYnJvYWRjYXN0ID0gKG1lc3NhZ2U6IE1lc3NhZ2VPYmopID0+IHtcbiAgICBsZXQgZXZlbnQgPSB0aGlzLmNyZWF0ZUV2ZW50KG1lc3NhZ2UubWVzc2FnZSk7XG4gICAgXG4gICAgaWYgKG1lc3NhZ2U/LnRvKSB7XG4gICAgICBsZXQgZGVzdGluYXRpb24gPSBtZXNzYWdlLnRvO1xuICAgICAgZXZlbnQuZGV0YWlsWyd0byddID0gZGVzdGluYXRpb247XG4gICAgICBsZXQgbmV4dERlc3RpbmF0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICBsZXQgcmVtYWluaW5nOiBzdHJpbmdbXTtcbiAgICAgIFxuICAgICAgLy8gSWYgdGhlcmUgYXJlIGludGVybWVkaWF0ZSBkZXN0aW5hdGlvbnNcbiAgICAgIC8vIEV4YW1wbGU6ICdiYWNrZ3JvdW5kOnRhYjp3aW5kb3cnXG4gICAgICBpZiAoZGVzdGluYXRpb24uaW5jbHVkZXMoJzonKSkge1xuICAgICAgICBbZGVzdGluYXRpb24sIC4uLnJlbWFpbmluZ10gPSBtZXNzYWdlLnRvLnNwbGl0KCc6Jyk7XG4gICAgICAgIG5leHREZXN0aW5hdGlvbiA9IHJlbWFpbmluZy5qb2luKCc6Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25zLmhhcyhkZXN0aW5hdGlvbikpIHtcbiAgICAgICAgZXZlbnQgPSB0aGlzLmNyZWF0ZUV2ZW50KGRlc3RpbmF0aW9uKTtcbiAgICAgICAgZXZlbnQuZGV0YWlsWyd0byddID0gbmV4dERlc3RpbmF0aW9uO1xuICAgICAgfVxuICAgIH1cblxuICAgIGV2ZW50LmRldGFpbFsnbWVzc2FnZSddID0gbWVzc2FnZS5tZXNzYWdlO1xuICAgIGV2ZW50LmRldGFpbFsncGF5bG9hZCddID0gbWVzc2FnZS5wYXlsb2FkO1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gIH1cblxuICBwdWJsaWMgbGlzdGVuID0gPFQgPSBhbnk+KG5hbWU6IHN0cmluZywgZm46IEN1c3RvbUV2ZW50TGlzdGVuZXI8VD4pID0+IHtcbiAgICBmdW5jdGlvbiB3cmFwcGVkRm4oZXZlbnQ6IEN1c3RvbUV2ZW50PE1lc3NhZ2VPYmo8VD4+KSB7IFxuICAgICAgcmV0dXJuIGZuKGV2ZW50LmRldGFpbCk7IFxuICAgIH07XG5cbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIobmFtZSwgd3JhcHBlZEZuKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKG5hbWUsIHdyYXBwZWRGbik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNlbmQgPSAobWVzc2FnZU9iajogTWVzc2FnZU9iaikgPT4ge1xuICAgIHRoaXMuYnJvYWRjYXN0KG1lc3NhZ2VPYmopO1xuICB9XG5cbiAgcHVibGljIGZvcndhcmQgPSAobWVzc2FnZTogc3RyaW5nLCBuZXdSZWNpcGllbnQ6IHN0cmluZykgID0+IHtcbiAgICByZXR1cm4gdGhpcy5saXN0ZW4obWVzc2FnZSwgbWVzc2FnZU9iaiA9PiB7XG4gICAgICB0aGlzLmJyb2FkY2FzdCh7XG4gICAgICAgIC4uLm1lc3NhZ2VPYmosXG4gICAgICAgIHRvOiBuZXdSZWNpcGllbnQsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSZWxheTtcbiIsImltcG9ydCB7IE1lc3NhZ2VPYmogfSBmcm9tICcuLi90eXBlcyc7XG5cbmV4cG9ydCB0eXBlIEV2ZW50TGlzdGVuZXI8VCA9IGFueT4gPSAoZXZlbnQ6IEN1c3RvbUV2ZW50PE1lc3NhZ2VPYmo8VD4+KSA9PiB2b2lkO1xuXG5jbGFzcyBFdmVudFRhcmdldCB7XG4gIGxpc3RlbmVycyA9IG5ldyBNYXA8c3RyaW5nLCBTZXQ8RXZlbnRMaXN0ZW5lcj4+KCk7XG5cbiAgYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGU6IHN0cmluZywgY2FsbGJhY2s6IEV2ZW50TGlzdGVuZXIpIHtcbiAgICBjb25zdCBpc1JlZ2lzdGVyZWQgPSB0aGlzLmxpc3RlbmVycy5oYXMoZXZlbnRUeXBlKTtcbiAgICBcbiAgICBpZiAoIWlzUmVnaXN0ZXJlZCkge1xuICAgICAgdGhpcy5saXN0ZW5lcnMuc2V0KGV2ZW50VHlwZSwgbmV3IFNldDxFdmVudExpc3RlbmVyPigpKTtcbiAgICB9XG5cbiAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVycy5nZXQoZXZlbnRUeXBlKTtcbiAgICBsaXN0ZW5lcnMhLmFkZChjYWxsYmFjayk7XG4gIH1cblxuICByZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50VHlwZTogc3RyaW5nLCBjYWxsYmFjaykge1xuICAgIGNvbnN0IGlzUmVnaXN0ZXJlZCA9IHRoaXMubGlzdGVuZXJzLmhhcyhldmVudFR5cGUpO1xuXG4gICAgaWYgKGlzUmVnaXN0ZXJlZCkge1xuICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnMuZ2V0KGV2ZW50VHlwZSk7XG4gICAgICBsaXN0ZW5lcnMhLmRlbGV0ZShjYWxsYmFjayk7XG4gICAgfVxuICB9XG5cbiAgZGlzcGF0Y2hFdmVudChldmVudDogQ3VzdG9tRXZlbnQpIHtcbiAgICBjb25zdCBpc1JlZ2lzdGVyZWQgPSB0aGlzLmxpc3RlbmVycy5oYXMoZXZlbnQ/LnR5cGUpO1xuXG4gICAgaWYgKGlzUmVnaXN0ZXJlZCkge1xuICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnMuZ2V0KGV2ZW50LnR5cGUpO1xuICAgICAgbGlzdGVuZXJzIS5mb3JFYWNoKGxpc3RlbmVyID0+IGxpc3RlbmVyKGV2ZW50KSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV2ZW50VGFyZ2V0O1xuXG5cbiIsImV4cG9ydCBjb25zdCBDTElFTlRfRk9VTkQgPSAnY2xpZW50LWZvdW5kJztcbmV4cG9ydCBjb25zdCBSRVFVRVNUX1RBQl9JRCA9ICdyZXF1ZXN0LXRhYi1pZCc7XG5leHBvcnQgY29uc3QgREVWVE9PTFNfSU5JVElBTElaRUQgPSAnZGV2dG9vbHMtaW5pdGlhbGl6ZWQnO1xuZXhwb3J0IGNvbnN0IEZJTkRfQVBPTExPX0NMSUVOVCA9ICdmaW5kLWFwb2xsby1jbGllbnQnO1xuZXhwb3J0IGNvbnN0IEFQT0xMT19DTElFTlRfRk9VTkQgPSAnYXBvbGxvLWNsaWVudC1mb3VuZCc7XG5leHBvcnQgY29uc3QgQ1JFQVRFX0RFVlRPT0xTX1BBTkVMID0gJ2NyZWF0ZS1kZXZ0b29scy1wYW5lbCc7XG5leHBvcnQgY29uc3QgQUNUSU9OX0hPT0tfRklSRUQgPSAnYWN0aW9uLWhvb2stZmlyZWQnO1xuZXhwb3J0IGNvbnN0IFJFUVVFU1RfREFUQSA9ICdyZXF1ZXN0LWRhdGEnO1xuZXhwb3J0IGNvbnN0IFVQREFURSA9ICd1cGRhdGUnO1xuZXhwb3J0IGNvbnN0IFBBTkVMX09QRU4gPSAncGFuZWwtb3Blbic7XG5leHBvcnQgY29uc3QgUEFORUxfQ0xPU0VEID0gJ3BhbmVsLWNsb3NlZCc7XG5leHBvcnQgY29uc3QgR1JBUEhJUUxfUkVRVUVTVCA9ICdncmFwaGlxbC1yZXF1ZXN0JztcbmV4cG9ydCBjb25zdCBHUkFQSElRTF9SRVNQT05TRSA9ICdncmFwaGlxbC1yZXNwb25zZSc7XG5leHBvcnQgY29uc3QgUkVMT0FESU5HX1RBQiA9ICdyZWxvYWRpbmctdGFiJztcbmV4cG9ydCBjb25zdCBSRUxPQURfVEFCX0NPTVBMRVRFID0gJ3JlbG9hZC10YWItY29tcGxldGUnO1xuIiwiaW1wb3J0IFJlbGF5IGZyb20gJy4uLy4uL1JlbGF5JztcbmltcG9ydCB7IFxuICBERVZUT09MU19JTklUSUFMSVpFRCwgXG4gIENSRUFURV9ERVZUT09MU19QQU5FTCxcbiAgUkVRVUVTVF9EQVRBLFxuICBVUERBVEUsXG4gIFBBTkVMX09QRU4sXG4gIFBBTkVMX0NMT1NFRCxcbiAgR1JBUEhJUUxfUkVRVUVTVCxcbiAgUkVMT0FESU5HX1RBQixcbiAgUkVMT0FEX1RBQl9DT01QTEVURSxcbn0gZnJvbSAnLi4vY29uc3RhbnRzJztcblxuY29uc3QgaW5zcGVjdGVkVGFiSWQgPSBjaHJvbWUuZGV2dG9vbHMuaW5zcGVjdGVkV2luZG93LnRhYklkO1xuY29uc3QgZGV2dG9vbHMgPSBuZXcgUmVsYXkoKTtcblxuY29uc3QgcG9ydCA9IGNocm9tZS5ydW50aW1lLmNvbm5lY3Qoe1xuICBuYW1lOiBgZGV2dG9vbHMtJHtpbnNwZWN0ZWRUYWJJZH1gLFxufSk7XG5wb3J0Lm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihkZXZ0b29scy5icm9hZGNhc3QpO1xuXG5kZXZ0b29scy5hZGRDb25uZWN0aW9uKCdiYWNrZ3JvdW5kJywgbWVzc2FnZSA9PiB7XG4gIHBvcnQucG9zdE1lc3NhZ2UobWVzc2FnZSk7XG59KTtcblxuZnVuY3Rpb24gc2VuZE1lc3NhZ2VUb0NsaWVudChtZXNzYWdlOiBhbnkpIHtcbiAgZGV2dG9vbHMuc2VuZCh7XG4gICAgbWVzc2FnZSxcbiAgICB0bzogYGJhY2tncm91bmQ6dGFiLSR7aW5zcGVjdGVkVGFiSWR9OmNsaWVudGBcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHN0YXJ0UmVxdWVzdEludGVydmFsKG1zID0gNTAwKSB7XG4gIHNlbmRNZXNzYWdlVG9DbGllbnQoUkVRVUVTVF9EQVRBKTtcbiAgY29uc3QgaWQgPSBzZXRJbnRlcnZhbChzZW5kTWVzc2FnZVRvQ2xpZW50LCBtcywgUkVRVUVTVF9EQVRBKTtcbiAgcmV0dXJuICgpID0+IGNsZWFySW50ZXJ2YWwoaWQpO1xufVxuXG5zZW5kTWVzc2FnZVRvQ2xpZW50KERFVlRPT0xTX0lOSVRJQUxJWkVEKTtcblxubGV0IGlzUGFuZWxDcmVhdGVkID0gZmFsc2U7XG5sZXQgaXNBcHBJbml0aWFsaXplZCA9IGZhbHNlO1xuXG5kZXZ0b29scy5saXN0ZW4oQ1JFQVRFX0RFVlRPT0xTX1BBTkVMLCAoeyBwYXlsb2FkIH0pID0+IHtcbiAgaWYgKCFpc1BhbmVsQ3JlYXRlZCkge1xuICAgIGNocm9tZS5kZXZ0b29scy5wYW5lbHMuY3JlYXRlKCdBcG9sbG8nLFxuICAgICAgJ2xvZ29fZGV2dG9vbHMucG5nJyxcbiAgICAgICdwYW5lbC5odG1sJyxcbiAgICAgIGZ1bmN0aW9uKHBhbmVsKSB7XG4gICAgICAgIGlzUGFuZWxDcmVhdGVkID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgeyBxdWVyaWVzLCBtdXRhdGlvbnMsIGNhY2hlIH0gPSBKU09OLnBhcnNlKHBheWxvYWQpO1xuICAgICAgICBsZXQgcmVtb3ZlVXBkYXRlTGlzdGVuZXI7XG4gICAgICAgIGxldCByZW1vdmVHcmFwaGlRTEZvcndhcmQ7XG4gICAgICAgIGxldCByZW1vdmVSZWxvYWRMaXN0ZW5lcjtcbiAgICAgICAgbGV0IGNsZWFyUmVxdWVzdEludGVydmFsO1xuICAgICAgICBsZXQgcmVtb3ZlR3JhcGhpUUxMaXN0ZW5lcjtcblxuICAgICAgICBwYW5lbC5vblNob3duLmFkZExpc3RlbmVyKHdpbmRvdyA9PiB7XG4gICAgICAgICAgc2VuZE1lc3NhZ2VUb0NsaWVudChQQU5FTF9PUEVOKTtcblxuICAgICAgICAgIGNvbnN0IHsgXG4gICAgICAgICAgICBfX0RFVlRPT0xTX0FQUExJQ0FUSU9OX186IHtcbiAgICAgICAgICAgICAgaW5pdGlhbGl6ZSxcbiAgICAgICAgICAgICAgd3JpdGVEYXRhLFxuICAgICAgICAgICAgICByZWNlaXZlR3JhcGhpUUxSZXF1ZXN0cyxcbiAgICAgICAgICAgICAgc2VuZFJlc3BvbnNlVG9HcmFwaGlRTCxcbiAgICAgICAgICAgICAgaGFuZGxlUmVsb2FkLFxuICAgICAgICAgICAgICBoYW5kbGVSZWxvYWRDb21wbGV0ZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9ID0gKHdpbmRvdyBhcyBhbnkpO1xuXG4gICAgICAgICAgaWYgKCFpc0FwcEluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICBpbml0aWFsaXplKCk7XG4gICAgICAgICAgICB3cml0ZURhdGEoeyBxdWVyaWVzLCBtdXRhdGlvbnMsIGNhY2hlOiBKU09OLnN0cmluZ2lmeShjYWNoZSkgfSk7XG4gICAgICAgICAgICBpc0FwcEluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjbGVhclJlcXVlc3RJbnRlcnZhbCA9IHN0YXJ0UmVxdWVzdEludGVydmFsKCk7XG4gICAgICAgICAgXG4gICAgICAgICAgcmVtb3ZlVXBkYXRlTGlzdGVuZXIgPSBkZXZ0b29scy5saXN0ZW4oVVBEQVRFLCAoeyBwYXlsb2FkIH0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgcXVlcmllcywgbXV0YXRpb25zLCBjYWNoZSB9ID0gSlNPTi5wYXJzZShwYXlsb2FkKTtcbiAgICAgICAgICAgIHdyaXRlRGF0YSh7IHF1ZXJpZXMsIG11dGF0aW9ucywgY2FjaGU6IEpTT04uc3RyaW5naWZ5KGNhY2hlKSB9KTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIEFkZCBjb25uZWN0aW9uIHNvIGNsaWVudCBjYW4gc2VuZCB0byBgYmFja2dyb3VuZDpkZXZ0b29scy0ke2luc3BlY3RlZFRhYklkfTpncmFwaGlxbGBcbiAgICAgICAgICBkZXZ0b29scy5hZGRDb25uZWN0aW9uKCdncmFwaGlxbCcsIHNlbmRSZXNwb25zZVRvR3JhcGhpUUwpO1xuICAgICAgICAgIHJlbW92ZUdyYXBoaVFMTGlzdGVuZXIgPSByZWNlaXZlR3JhcGhpUUxSZXF1ZXN0cygoeyBkZXRhaWwgfSkgPT4ge1xuICAgICAgICAgICAgZGV2dG9vbHMuYnJvYWRjYXN0KGRldGFpbCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBGb3J3YXJkIGFsbCBHcmFwaGlRTCByZXF1ZXN0cyB0byB0aGUgY2xpZW50XG4gICAgICAgICAgcmVtb3ZlR3JhcGhpUUxGb3J3YXJkID0gZGV2dG9vbHMuZm9yd2FyZChHUkFQSElRTF9SRVFVRVNULCBgYmFja2dyb3VuZDp0YWItJHtpbnNwZWN0ZWRUYWJJZH06Y2xpZW50YCk7XG5cbiAgICAgICAgICAvLyBMaXN0ZW4gZm9yIHRhYiByZWxvYWQgZnJvbSBiYWNrZ3JvdW5kXG4gICAgICAgICAgcmVtb3ZlUmVsb2FkTGlzdGVuZXIgPSBkZXZ0b29scy5saXN0ZW4oUkVMT0FESU5HX1RBQiwgKCkgPT4ge1xuICAgICAgICAgICAgaGFuZGxlUmVsb2FkKCk7XG4gICAgICAgICAgICBjbGVhclJlcXVlc3RJbnRlcnZhbCgpO1xuXG4gICAgICAgICAgICBjb25zdCByZW1vdmVMaXN0ZW5lciA9IGRldnRvb2xzLmxpc3RlbihSRUxPQURfVEFCX0NPTVBMRVRFLCAoKSA9PiB7XG4gICAgICAgICAgICAgIGNsZWFyUmVxdWVzdEludGVydmFsID0gc3RhcnRSZXF1ZXN0SW50ZXJ2YWwoKTtcbiAgICAgICAgICAgICAgaGFuZGxlUmVsb2FkQ29tcGxldGUoKTtcbiAgICAgICAgICAgICAgcmVtb3ZlTGlzdGVuZXIoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBwYW5lbC5vbkhpZGRlbi5hZGRMaXN0ZW5lcigoKSA9PiB7XG4gICAgICAgICAgaXNQYW5lbENyZWF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICBjbGVhclJlcXVlc3RJbnRlcnZhbCgpO1xuICAgICAgICAgIHJlbW92ZUdyYXBoaVFMRm9yd2FyZCgpO1xuICAgICAgICAgIHJlbW92ZVVwZGF0ZUxpc3RlbmVyKCk7XG4gICAgICAgICAgcmVtb3ZlUmVsb2FkTGlzdGVuZXIoKTtcbiAgICAgICAgICByZW1vdmVHcmFwaGlRTExpc3RlbmVyKCk7XG4gICAgICAgICAgZGV2dG9vbHMucmVtb3ZlQ29ubmVjdGlvbignZ3JhcGhpcWwnKTtcbiAgICAgICAgICBzZW5kTWVzc2FnZVRvQ2xpZW50KFBBTkVMX0NMT1NFRCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICk7XG4gIH1cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==